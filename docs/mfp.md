
# Multiplex Frame Protocol (MFP)

- [–¢–∏–ø—ã –ø–æ–¥–ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤](#—Ç–∏–ø—ã-–ø–æ–¥–ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤)
- [–°—Ö–µ–º–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞](#—Å—Ö–µ–º–∞-–ø—Ä–æ—Ç–æ–∫–æ–ª–∞)
- [–°–ª—É–∂–µ–±–Ω—ã–π —Ñ—Ä–µ–π–º](#—Å–ª—É–∂–µ–±–Ω—ã–π-—Ñ—Ä–µ–π–º)
- [–ë–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ](#–±–∏–Ω–∞—Ä–Ω—ã–µ-–¥–∞–Ω–Ω—ã–µ)
- [–ü—Ä–∏–º–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π](#–ø—Ä–∏–º–µ—Ä—ã-—Å–æ–æ–±—â–µ–Ω–∏–π)

–ë–∏–Ω–∞—Ä–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è WebSocket(–∏ –ª—é–±–æ–≥–æ –¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞), –º—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–∏—Ä—É—é—â–∏–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –∑–∞–ø—Ä–æ—Å—ã-–æ—Ç–≤–µ—Ç—ã –∏ –ø–æ—Ç–æ–∫–æ–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É —Ñ–∞–π–ª–æ–≤ –≤ –æ–¥–Ω–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏. –ü—Ä–æ—Ç–æ–∫–æ–ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –±–∏—Ç–æ–≤—ã–º–∏ —Ñ–ª–∞–≥–∞–º–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ—Ä–µ–π–º–∞, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–∏, JSON –∏ –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–¥–Ω–æ–º —Ñ—Ä–µ–π–º–µ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞–∫–ª–∞–¥–Ω—ã–º–∏ —Ä–∞—Å—Ö–æ–¥–∞–º–∏.

**–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞:**

`MFP` —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å–ª–æ–∂–Ω–æ–π –∏ –Ω–µ—É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ —Ä–∞–∑–Ω–æ—Ä–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏. –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –∏–∑–æ–±—Ä–µ—Ç–∞—Ç—å —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é –∏–ª–∏ –∑–∞–≤–æ–¥–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –¥–ª—è JSON, –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö –∫–æ–º–∞–Ω–¥ ‚Äî _–≤—Å—ë –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –æ–¥–Ω–æ–º –∫–æ–º–ø–∞–∫—Ç–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏, –≥–¥–µ –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –∏–º–µ–µ—Ç —á—ë—Ç–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Å–º—ã—Å–ª_.

–ü—Ä–æ—Ç–æ–∫–æ–ª –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –≤ –æ–¥–Ω–æ–º —Ñ—Ä–µ–π–º–µ:

    [–û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ –¥–∞–Ω–Ω—ã—Ö][–ö–∞—Ä—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π][file 1][file 2][file N][–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞]

–ü—Ä–æ—Ç–æ–∫–æ–ª –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—É—é —Å—Ö–µ–º—É –ø–µ—Ä–µ–¥–∞—á–∏/–∑–∞–ø—Ä–æ—Å–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Ñ–∞–π–ª–æ–≤:

```ts
const response = await request({ 
  endpoint: 'chat'
  data: 'Hello friend, here are my pictures.', 
  files: new Map([[0, {type: 'image/png', name: 'me.png', bin: ArrayBuffer}], ...])
})
```

–ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–µ–≥–∫–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è:

```ts
connection.on('chat', (data: JsonLike, files: Map) => {
  console.log(data) // 'Hello friend, here are my pictures.'
  const file = files.get(0) // name:'me.png'
})
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

* –ó–∞–ø—Ä–æ—Å—ã —Å –ª—é–±—ã–º —Ç–∏–ø–æ–º —Ä–∞–∑–Ω–æ—Ä–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –æ–¥–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏: `json(string) + binary(ArrayBuffer)`. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∂–¥–æ–≥–æ —Ñ—Ä–µ–π–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –æ–¥–Ω–∏–º –±–∞–π—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–∏–ø –ø–æ–¥–ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –∏ –Ω–∞–±–æ—Ä –±–∏—Ç–æ–≤—ã—Ö —Ñ–ª–∞–≥–æ–≤, –æ–ø–∏—Å—ã–≤–∞—é—â–∏—Ö –Ω–∞–ª–∏—á–∏–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π.
* –ú–µ—Ö–∞–Ω–∏–∑–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ—Ä–µ–π–º–∞ —Å–æ–æ–±—â–µ–Ω–∏—è). –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ—Ä–µ–π–º–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ. –ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω –≤ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞—Ç–æ–º.
* –ü–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ—Ç–æ–∫–æ–ª –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–Ω–æ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±–∏–Ω–∞—Ä–Ω—ã—Ö –±–ª–æ–∫–æ–≤, –∞ –∑–∞—Ç–µ–º –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ —á–∞—Å—Ç—è–º –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã—Ö –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –∞–Ω–æ–Ω—Å—É.
* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ). –ü—Ä–æ—Ç–æ–∫–æ–ª –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º —Ñ–ª–∞–≥–æ–º –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –µ—ë —Ç–æ–ª—å–∫–æ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –ê–ª–≥–æ—Ä–∏—Ç–º –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä `CRC32`), –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤, —Å–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞–µ—Ç—Å—è —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–ª–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

**–¢–∏–ø—ã –æ–ø–µ—Ä–∞—Ü–∏–π:**

* –ü—Ä–æ—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å–º–µ—à–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤ –æ–¥–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏.
* –ó–∞–ø—Ä–æ—Å—ã —Å–æ —Å–º–µ—à–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ `POST` –∏ –æ–∂–∏–¥–∞–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
* –°–æ–æ–±—â–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å –±–∏–Ω–∞—Ä–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º–æ–µ –∫ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é –ø–æ `id`.
* –û—Ç–≤–µ—Ç—ã –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã —Å–æ —Å–º–µ—à–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏. 

## –¢–∏–ø—ã –ø–æ–¥–ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤

–ü–æ–¥ _–ø–æ–¥–ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º_ —Å–ª–µ–¥—É–µ—Ç –ø–æ–Ω–∏–º–∞—Ç—å –≤—ã–±–æ—Ä –¥–µ–∫–æ–¥–µ—Ä–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ö–µ–º—ã —Ñ—Ä–µ–π–º–∞ —Å–æ–æ–±—â–µ–Ω–∏—è.
–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ `7`, —á—Ç–æ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –∏, –≤–æ–∑–º–æ–∂–Ω—ã–µ, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.

–¢–∏–ø—ã –ø–æ–¥–ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ (–æ—Ç 0 –¥–æ 7):

* **0** - –†–µ–∑–µ—Ä–≤–Ω—ã–π.
* **1 service** - –°–ª—É–∂–µ–±–Ω—ã–π —Ñ—Ä–µ–π–º. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è, ... –∏ PING/PONG.
* **2 message** - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞.
* **3 request** - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –æ—Ç–≤–µ—Ç–∞.
* **4 binary** - –ë–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –Ω–æ–º–µ—Ä–æ–º —Ñ–∞–π–ª–∞.
* **5 response** - –û—Ç–≤–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å `request` –ø–æ–¥–æ–±–Ω—ã–π `POST`.
* **6-7** - ... –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π.

> –ó–∞–º–µ—á–∞–Ω–∏–µ: –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ `request` —Å–æ–≥–ª–∞—Å–æ–≤—ã–≤–∞–µ—Ç—Å—è —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–ª–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

## –°—Ö–µ–º–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞

> –ü–æ–ª—è, –∏–¥—É—â–∏–µ –∑–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –ø–µ—Ä–≤—ã–º–∏ —á–µ—Ç—ã—Ä—å–º—è —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏, –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø–æ–¥–ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –∏/–∏–ª–∏ —è–≤–ª—è—é—Ç—Å—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏.

    [protocol: 3 –±–∏—Ç–∞][verification: 1 –±–∏—Ç][flags: 4 –±–∏—Ç][id: 4 –±–∞–π—Ç–∞][refId: 4 –±–∞–π—Ç–∞][size(payload): 4 –±–∞–π—Ç–∞][size(map): 4 –±–∞–π—Ç–∞][payload: N –±–∞–π—Ç][map: N –±–∞–π—Ç][bin: N –±–∞–π—Ç][checksum: N –±–∞–π—Ç]

| –ü–æ–ª–µ                     | –†–∞–∑–º–µ—Ä        | –ü—Ä–æ—Ç–æ–∫–æ–ª |
| ------------------------ | ------------- | -------- |
| protocol                 | 3 –±–∏—Ç–∞        | –í—Å–µ      |
| checksum verification    | 1 –±–∏—Ç         | –í—Å–µ      |
| flags                    | 4 –±–∏—Ç–∞        | –í—Å–µ      |
| id                       | 4 –±–∞–π—Ç–∞       | –í—Å–µ      |
| refId                    | 4 –±–∞–π—Ç–∞       | 1/4/5    |
| size(payload) (optional) | 4 –±–∞–π—Ç–∞       | 2/3/5    |
| size(map) (optional)     | 4 –±–∞–π—Ç–∞       | 2/3/5    |
| payload (optional)       | size(payload) | 2/3/5    |
| map (optional)           | size(map)     | 2/3/5    |
| key (optional)           | 4 –±–∞–π—Ç–∞       | 4        |
| bin (optional)           | N –±–∞–π—Ç        | 2/3/5/4  |
| checksum (if 0b00010000) | N –±–∞–π—Ç        | –í—Å–µ      |

–ü–µ—Ä–≤—ã–µ —á–µ—Ç—ã—Ä–µ —Å–µ–≥–º–µ–Ω—Ç–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤ –ª—é–±–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏:

+ **protocol 3 –±–∏—Ç–∞** - –¢–∏–ø –ø–æ–¥–ø—Ä–æ—Ç–æ–∫–æ–ª–∞, –æ—Ç `0` –¥–æ `7`.
+ **verification 1 –±–∏—Ç** - –§–ª–∞–≥ –Ω–∞–ª–∏—á–∏—è `checksum` –≤ –∫–æ–Ω—Ü–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
+ **flags 4 –±–∏—Ç** - –§–ª–∞–≥–∏ –ø–æ–ª–µ–π —Å–æ–æ–±—â–µ–Ω–∏—è.
+ **id 4 –±–∞–π—Ç–∞** - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è –∫–∞–∂–¥–æ–π –∏–∑ —Å—Ç–æ—Ä–æ–Ω –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç `1` –¥–æ `0xFFFF_FFFF`.

> –ó–∞–º–µ—á–∞–Ω–∏–µ: –•–æ—Ç—è —Ñ–ª–∞–≥ –Ω–∞–ª–∏—á–∏—è `checksum` –≤–∫–ª—é—á–µ–Ω –≤ –ø—Ä–æ—Ç–æ–∫–æ–ª, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–∂–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ñ–ª–∞–≥ –∏ —è–≤–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å/–≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Å—É–º–º—É.

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ–ª–∞–≥–∏ **2(4 –±–∏—Ç)** –ø–æ–ª–µ–π —Å–æ–æ–±—â–µ–Ω–∏—è:

> –ß–∏—Ç–∞–π –Ω–∏–∂–µ [–°–ª—É–∂–µ–±–Ω—ã–π —Ñ—Ä–µ–π–º](#—Å–ª—É–∂–µ–±–Ω—ã–π-—Ñ—Ä–µ–π–º) –∏ –∫–∞–∫ [–ë–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ](#–±–∏–Ω–∞—Ä–Ω—ã–µ-–¥–∞–Ω–Ω—ã–µ) –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é—Ç —Ñ–ª–∞–≥–∏ –≤ `protocol:binary`.

* **0b0001** - –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ.
* **0b0010** - –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–∞—Ä—Ç–∞ —Ñ–∞–π–ª–æ–≤ –≤–∏–¥–∞ `[number(key), number(size)][]` –∫—Ä–∞—Ç–Ω–∞—è 8(4+4) –±–∞–π—Ç–∞–º. –ú–æ–∂–µ—Ç –±—ã—Ç—å –∫—Ä–∞—Ç–Ω–æ 4 –±–∞–π—Ç–∞–º `number(key)[]`, –µ—Å–ª–∏ —ç—Ç–æ –∞–Ω–æ–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –±–µ–∑ —Å–∞–º–∏—Ö —Ñ–∞–π–ª–æ–≤ `0b0100`.
* **0b0100** - –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–∞–∑–º–µ—Ä–∞–º –∫–∞—Ä—Ç—ã –∏–ª–∏, –µ—Å–ª–∏ –∫–∞—Ä—Ç—ã –Ω–µ—Ç, –Ω–∞—á–∞–ª–æ –ø–µ—Ä–µ–¥–∞—á–∏ –ø–æ—Ç–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
* **0b1000** - –ó–∞–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã—Å–ª–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ(—ç—Ç–æ –Ω–µ –∑–Ω–∞—á–∏—Ç —á—Ç–æ –µ–≥–æ –ø—Ä–æ—á–∏—Ç–∞–ª –ø–æ–ª—É—á–∞—Ç–µ–ª—å).

–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ `refId(4 –±–∞–π—Ç–∞)` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–¥–ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤:

* **protocol:service** - –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–ª—É—á–µ–Ω–æ, –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–æ –∏ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
* **protocol:binary** - –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∫ –∫–æ—Ç–æ—Ä–æ–º—É —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–ª–æ–∂–∏—Ç—å —Ñ–∞–π–ª.
* **protocol:response** - –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –æ—Ç–≤–µ—Ç.

–ù–∞–ª–∏—á–∏–µ –ø–æ–ª–µ–π –∏ –¥–∞–Ω–Ω—ã—Ö –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è —Ñ–ª–∞–≥–∞–º–∏ –∏ –∏–¥—É—Ç –≤ —Å—Ç—Ä–æ–≥–æ–º –ø–æ—Ä—è–¥–∫–µ:

+ **size(payload) 4 –±–∞–π—Ç–∞** - –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –µ—Å–ª–∏ –µ—Å—Ç—å —Ñ–ª–∞–≥ `0b0001`.
+ **size(map) 4 –±–∞–π—Ç–∞** - –†–∞–∑–º–µ—Ä –∫–∞—Ä—Ç—ã –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∫—Ä–∞—Ç–Ω—ã–π 8(4+4) –∏–ª–∏ 4(–±–µ–∑ —Ñ–∞–π–ª–æ–≤) –±–∞–π—Ç–∞–º –µ—Å–ª–∏ –µ—Å—Ç—å —Ñ–ª–∞–≥ `0b0010`.
+ **payload N –±–∞–π—Ç** - –î–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –µ—Å—Ç—å —Ñ–ª–∞–≥ `0b0001`.
+ **map N –±–∞–π—Ç** - –ö–∞—Ä—Ç–∞ —Ñ–∞–π–ª–æ–≤ –µ—Å–ª–∏ –µ—Å—Ç—å —Ñ–ª–∞–≥ `0b0010`.
+ **key 4 –±–∞–π—Ç** - –¢–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ `protocol:binary` - –Ω–æ–º–µ—Ä –±–∏–Ω–∞—Ä–Ω–æ–≥–æ —Ñ–∞–π–ª–∞.
+ **bin N –±–∞–π—Ç** - –ë–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –µ—Å—Ç—å —Ñ–ª–∞–≥ `0b0100`.

## –°–ª—É–∂–µ–±–Ω—ã–π —Ñ—Ä–µ–π–º

> –ó–∞–º–µ—á–∞–Ω–∏–µ: –°–ª—É–∂–µ–±–Ω—ã–π —Ñ—Ä–µ–π–º `service` —Ç–æ–ª—å–∫–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∏ –Ω–µ –∏–º–µ–µ—Ç —Ñ–ª–∞–≥–∞ `0b1000`(—Å–º–æ—Ç—Ä–∏ –Ω–∏–∂–µ).

–§–ª–∞–≥–∏ —Å–ª—É–∂–µ–±–Ω–æ–≥–æ —Ñ—Ä–µ–π–º–∞ **protocol:service** –æ—Ü–µ–Ω–∏–≤–∞—é—Ç—Å—è –∫–∞–∫ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ç—Ä–µ—Ö –±–∏—Ç `0b0111`:

* **0** - –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏ —Å–ª—É–∂–∏—Ç –∑–∞–≥–ª—É—à–∫–æ–π –¥–ª—è —Ç–∏–ø–∞.
* **1:ack** - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –µ–≥–æ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
* **2:timeout** - –ù–∞–º–∏ –ø–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å(protocol:request), –Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª–æ –æ—Ç–≤–µ—Ç –≤ –æ—Ç–≤–µ–¥–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ—Ç–≤–µ—Ç–∞ protocol:response. _–ü–æ—á–µ–º—É –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å —Ç–∞–∫–∞—è –æ—à–∏–±–∫–∞? –°–ª–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π timeout –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è._
* **3:abort** - –û–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–µ—Ä–≤–∞—Ç—å –ø–µ—Ä–µ–¥–∞—á—É —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏(protocol:binary) –∏–ª–∏ –æ—Ç–≤–µ—Ç–∞–º–∏(protocol:response) –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞.
* **4:unknown** - –ù–∞–º–∏ –ø–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ (protocol:binary/response) —Å—Å—ã–ª–æ—á–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ—Ç–æ—Ä–æ–≥–æ (refId) –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω. –≠—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω.
* **5-6** - –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è(–¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π).
* **7:ping** - PING/. –î–ª—è PONG –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `ack:1`.

–ë–∏—Ç `0b1000` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ `refId` –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏. –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø—Ä–æ—Ç–æ–∫–æ–ª–∞, —É–Ω–∏–∫–∞–ª—å–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è. –ü–æ–ª—É—á–∏–≤ —Å–µ—Ä–≤–∏—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–Ω–∞—Ç—å –∫ –∫–æ–º—É –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –ø–æ–ª–µ `[refId: 4 –±–∞–π—Ç–∞]`:

* `0b1xxx` - –≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–æ —Å –º–æ–∏–º `refId`.
* `0b0xxx` - –≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–æ —Å —Ç–≤–æ–∏–º `refId`.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø–æ–ª—É—á–∞—Ç–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏—è —Å–º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–ª—è –∫–∞–∫–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å. –ü—Ä–∏–º–µ—Ä:

    // –û—Ç–º–µ–Ω–∏ –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–Ω–µ–µ –±—ã–ª –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω –º–Ω–æ–π, –≤–æ—Ç –º–æ–π refId
    [1:service][0][0b1011][id:FFFFFFFF][refId:FFFFFFFF]
    // –Ø –Ω–µ –¥–æ–∂–¥–∞–ª—Å—è –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å, –æ—Ç–º–µ–Ω–∏ –µ–≥–æ, –≤–æ—Ç —Ç–≤–æ–π refId
    [1:service][0][0b0010][id:FFFFFFFF][refId:FFFFFFFF]

## –ë–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ 

–ë–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ–¥–∞–Ω—ã –∫–∞–∫ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö/–∑–∞–ø—Ä–æ—Å–∞—Ö/–æ—Ç–≤–µ—Ç–∞—Ö —Ç–∞–∫ –∏ –æ—Ç–¥–µ–ª—å–Ω–æ:

* –î–∞–Ω–Ω—ã–µ –≤–º–µ—Å—Ç–µ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –∏–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–º protocol:message/request/response. –°–æ–æ–±—â–µ–Ω–∏—é —É—Å—Ç–∞–Ω–æ–≤–ª–∏–≤–∞—é—Ç—Å—è —Ñ–ª–∞–≥–∏ `0b0110` –∏ –ø—Ä–∏–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –∫–∞—Ä—Ç–∞ –∫—Ä–∞—Ç–Ω–∞—è 8(4+4) –±–∞–π—Ç `[key:4 –±–∞–π—Ç–∞, size:4 –±–∞–π—Ç–∞][]`.
* –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ(protocol:message) —Å –Ω–∞–±–æ—Ä–æ–º —Ñ–∞–π–ª–æ–≤ (`0b0010`) –∫—Ä–∞—Ç–Ω—ã–º 4 –±–∞–π—Ç–∞–º `key:4 –±–∞–π—Ç–∞[]`, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–π –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è—é—Ç—Å—è –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π protocol:binary –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Ü–µ–ª–æ—Å—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –ù–æ–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ –¥–æ–ª–∂–Ω—ã —Å—Ç—Ä–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ä–∞–Ω–µ–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –∫–∞—Ä—Ç–µ. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø—Ä–∏ –∫–æ—Ç–æ—Ä—ã—Ö –æ–¥–Ω–∞ –æ—à–∏–±–∫–∞ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ –≤–µ—Ä–Ω–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–µ–∑ –æ—à–∏–±–æ—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.
* –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ(protocol:message) –±–µ–∑ –∫–∞—Ä—Ç—ã —Ñ–∞–π–ª–æ–≤ (`0b0100`), –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–π –∏–¥–µ—Ç –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–π protocol:binary. –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –ø–æ—Ç–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø–æ—Ä—è–¥–∫–æ–≤—ã–º–∏ –Ω–æ–º–µ—Ä–∞–º–∏ –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ–º —Ñ–ª–∞–≥–æ–≤ –≤ protocol:binary.

> **–ó–∞–º–µ—á–∞–Ω–∏–µ**: –ü—Ä–æ—Ç–æ–∫–æ–ª—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤(protocol:request/response) –Ω–µ –º–æ–≥—É—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥–∞—á—É —Ñ–∞–π–ª–æ–≤ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö. **–ü—Ä–∏—á–∏–Ω–∞**: –ß–∞—Å—Ç–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –¥–ª—è —Å–±–æ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è, –¥–æ–ª–∂–Ω—ã –∑–∞–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –∏ —Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏, –Ω–æ –∑–∞–ø—Ä–æ—Å—ã —Å –æ—Ç–≤–µ—Ç–∞–º–∏ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—é—Ç –±—ã—Å—Ç—Ä—É—é —Ä–µ–∞–∫—Ü–∏—é –∏ —Ç–∞–π–º–∞—É—Ç—ã. –ü–æ—Ç–æ–∫–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –º–æ–≥—É—Ç –Ω–µ –∏–º–µ—Ç—å –∫–æ–Ω—Ü–∞ –∏ –Ω–µ—è—Å–Ω–æ –∫–∞–∫ –æ–±—Å–ª—É–∂–∏—Ç—å –æ—Ç–≤–µ—Ç –Ω–∞ —Ç–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å.

–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è:

–ö–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–¥–∞–µ—Ç —Ñ–∞–π–ª—ã –≤ –∫–∞—Ä—Ç–µ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –Ω–æ–º–µ—Ä–∞–º–∏ –∏ —Ä–∞–∑–º–µ—Ä–∞–º–∏ –Ω–µ –≤—ã—Ö–æ–¥—è—â–∏–º–∏ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã `0xFFFF_FFFF`.
–ü–æ –∫–ª—é—á–∞–º –∏ —Ä–∞–∑–º–µ—Ä–∞–º —Ñ–∞–π–ª–æ–≤ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è _–ø–ª–æ—Å–∫–∞—è –∫–∞—Ä—Ç–∞_ –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ —Å–æ–æ–±—â–µ–Ω–∏—é:

    [key1, size1]|[key2, size2]|...|[keyN, sizeN]
    // –î–ª—è –∞–Ω–æ–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ —Ñ–∞–π–ª–æ–≤
    key1|key2|...|keyN

–ü–æ—Å–ª–µ –∫–∞—Ä—Ç—ã, –≤ —Ç–æ–º –∂–µ –ø–æ—Ä—è–¥–∫–µ, –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ñ–∞–π–ª—ã:
    
    [key1, size1]|...|[keyN, sizeN]|file1|...|fileN

–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –∂–µ–ª–∞–µ—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–æ–±—â–µ–Ω–∏–π(protocol:message + protocol:binary) —Å –∑–∞—Ä–∞–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–π –∫–∞—Ä—Ç–æ–π, –∏ –Ω–µ –∂–µ–ª–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫–æ–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–ª–æ–∂–∏—Ç—å –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç—É `key:4 –±–∞–π—Ç–∞[]`. –ü—Ä–æ—Ç–æ–∫–æ–ª —ç—Ç–æ –æ—Ü–µ–Ω–∏—Ç –∫–∞–∫ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –±—É–¥–µ—Ç –¥–æ–∂–∏–¥–∞—Ç—å—Å—è –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö protocol:binary.

–§–ª–∞–≥–∏ protocol:binary –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É—é—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω–∞—á–µ, –Ω–æ —Å —Ç–æ –∂–µ —Å–µ–º–∞–Ω—Ç–∏–∫–æ–π –∫–∞–∫ –∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ protocol:message:

* **0b0001** - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç—Ç–æ–≥–æ –±–∏—Ç–∞ –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ —ç—Ç–æ –Ω–µ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –ï—Å–ª–∏ –±–∏—Ç –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω - —ç—Ç–æ –∑–∞–≤–µ—Ä—à–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Å–µ—Å—Å–∏—é –∏ –±–æ–ª–µ–µ –Ω–µ –æ–∂–∏–¥–∞—Ç—å —Ñ–∞–π–ª–æ–≤.
* **0b0010** - –§–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤—Å–ª–µ–¥ –∑–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∫–∞—Ä—Ç–æ–π —Å –Ω–æ–º–µ—Ä–æ–º —É–∫–∞–∑–∞–Ω–Ω—ã–º –≤ –∫–∞—Ä—Ç–µ.
* **0b0100** - –ë—ã–ª–∞ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –ø–æ—Ç–æ–∫–∞ –±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã. –í —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä —Ñ–∞–π–ª–∞ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –∫–ª—é—á.
* **0b0110** - –≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–Ω—ã–º —Ñ–∞–π–ª–æ–º –∏ –∑–¥–µ—Å—å –º–æ–≥—É—Ç –±—ã—Ç—å –ª—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ. –ù–æ–º–µ—Ä —Ñ–∞–π–ª–∞ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.
* **0b1000** - –ö–∞–∫ –∏ –≤–µ–∑–¥–µ - –≤–µ—Ä–Ω—É—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤ –ø–æ–ª—É—á–µ–Ω–∏–∏.

## –ü—Ä–∏–º–µ—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏–π

–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:

    [2:message][0][0b0001][id:FFFFFFFF][size(payload):FFFFFFFF][payload:N]

–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –∑–∞–ø—Ä–æ—Å–æ–º –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º(0b1000):

    [2:message][0][0b1001][id:FFFFFFFF][size(payload):FFFFFFFF][payload:N]

–¢–∞–∫–æ–µ —Ç–æ–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ü§î:

    [2:message][1][0b0000][id:FFFFFFFF][checksum(CRC32):FFFFFFFF]

–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã(0b0100 | 0b0010):

    // –ü–æ–ª–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å–æ –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    [2:message][1][0b1111][id:FFFFFFFF][size(payload):FFFFFFFF][size(map):FFFFFFFF][payload:N][map:N*8][bin:N][checksum(CRC32):FFFFFFFF]
    // –ö–∞–∫ –∏ –≤—ã—à–µ, –Ω–æ –Ω–µ—Ç –±–∏—Ç–∞ 0b0100, –∞ –∑–Ω–∞—á–∏—Ç —Ñ–∞–π–ª—ã —Å–µ–π—á–∞—Å –ø—Ä–∏–±–µ–≥—É—Ç –≤ protocol:binary
    [2:message][0][0b0011][id:FFFFFFFF][size(payload):FFFFFFFF][size(set):FFFFFFFF][payload:N][set:N*4]
    // –ù–∏—á–µ–≥–æ –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å —Ñ–ª–∞–≥ –±–∏–Ω–∞—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã—Ö —Ç–æ–∂–µ –Ω–µ—Ç - –æ–∑–Ω–∞—á–∞–µ—Ç –Ω–∞—á–∞–ª–æ
    // –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö protocol:binary
    [2:message][0][0b0100][id:FFFFFFFF]

–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:

> –ó–∞–º–µ—á–∞–Ω–∏–µ: –ó–∞–ø—Ä–æ—Å—ã –Ω–µ –º–æ–≥—É—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫–æ–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É `0b0100` –∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –æ–¥–Ω–æ–º —Ç–µ–ª–µ.

    // –ó–∞–ø—Ä–æ—Å—ã protocol:request –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã –∑–∞–ø—Ä–æ—Å–∞–º message, –Ω–æ –≤—Å–µ–≥–¥–∞ –æ–∂–∏–¥–∞—é—Ç –æ—Ç–≤–µ—Ç.
    // –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–ª–∞–≥ 0b1000, –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–æ–∂–µ—Ç –±—ã—Ç—å
    // –∏–∑–±—ã—Ç–æ—á–µ–Ω - –∑–∞–ø—Ä–æ—Å –æ–∂–∏–¥–∞–µ—Ç –æ—Ç–≤–µ—Ç–∞ –∏, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω timeout
    [3:request][0][0b0001][id:FFFFFFFF][size(payload):FFFFFFFF][payload:N]

–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–¥–∏–Ω –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π —Ñ–∞–π–ª:

> –ó–∞–º–µ—á–∞–Ω–∏–µ: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ `0b1000`, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–∫–∞–∑–∞–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞, –∞ –Ω–µ –¥–ª—è –≤—Å–µ–π –≥—Ä—É–ø–ø—ã –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–∏.

    // –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º —Ñ–∞–π–ª –∫ —Å–æ–æ–±—â–µ–Ω–∏—é refId –∏ —É–∫–∞–∑—ã–≤–∞–µ–º –ø–æ –∫–∞–∫–æ–π —Å—Ö–µ–º–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–ª–æ—Å—å
    // –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª 0b0010 –∏–ª–∏ –ø–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ 0b0100.
    [4:binary][0][0b1011][id:FFFFFFFF][refId:FFFFFFFF][key:FFFFFFFF][bin:N]
    // –ü–æ—Ç–æ–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∏–º–µ—é—â–∏–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–µ—Ä–µ–¥–∞–Ω—ã —Å —Ñ–ª–∞–≥–æ–º 0b0100
    // –ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ `0b0001`.
    [4:binary][1][0b0100][id:FFFFFFFF][refId:FFFFFFFF][key:FFFFFFFF][bin:N][checksum(CRC32):FFFFFFFF]
    // –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ —Ñ–∞–π–ª–∞. –ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è.
    [4:binary][1][0b0000][id:FFFFFFFF][refId:FFFFFFFF][checksum(CRC32):FFFFFFFF]
    // –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –∏–º–µ—é—â–µ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ —Ñ–∞–π–ª–∞–º –∏ –∑–∞–≤–µ—Ä—à–∞—é—â–µ–µ. –ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.
    [4:binary][0][0b0110][id:FFFFFFFF][refId:FFFFFFFF][payload:N]

–í–µ—Ä–Ω—É—Ç—å –æ—Ç–≤–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å:

> –ó–∞–º–µ—á–∞–Ω–∏–µ: –û—Ç–≤–µ—Ç—ã –Ω–µ –º–æ–≥—É—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫–æ–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É `0b0100` –∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã –≤ –æ–¥–Ω–æ–º —Ç–µ–ª–µ.

    // –û—Ç–≤–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å –∏–º–µ–µ—Ç —Ç—É –∂–µ —Å–µ–º–∞–Ω—Ç–∏–∫—É –∫–∞–∫ –∏ protocol:request.
    [5:response][0][0b0001][id:FFFFFFFF][refId:FFFFFFFF][size(payload):FFFFFFFF][payload:N]
    // –û—Ç–≤–µ—Ç—ã –º–æ–≥—É—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ 0b1000
    [5:response][0][0b1111][id:FFFFFFFF][refId:FFFFFFFF][size(payload):FFFFFFFF][size(map):FFFFFFFF][payload:N][map:N*8][bin:N]

–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞ –ª—é–±–æ–π —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏–π –∫—Ä–æ–º–µ —Å–∞–º–æ–≥–æ protocol:service:

> –§—Ä–µ–π–º—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø—Ä–æ—Ç–æ–∫–æ–ª–∞, –∞ –Ω–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞–º –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π, –Ω–æ –Ω–µ —Å—Ç–æ—Ä–æ–Ω–µ –¥–ª—è –∫–æ—Ç–æ—Ä–æ–π –∞–¥—Ä–µ—Å–æ–≤–∞–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ.

    // –°–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º refId —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω–æ
    [1:service][0][0b0000+1:ack][id:FFFFFFFF][refId:FFFFFFFF]
    // –£–¥–∞–ª–∏ –≤—Å–µ –∑–∞–¥–∞—á–∏ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ refId - –º—ã –Ω–µ —Å–º–æ–∂–µ–º –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å
    [1:service][0][0b1000+3:abort][id:FFFFFFFF][refId:FFFFFFFF]
